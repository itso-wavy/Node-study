<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>file-upload-client</title>
  <style>
    table {
      border-collapse: collapse;
    }

    table,
    th,
    td {
      border: 1px solid;
    }
  </style>
</head>
<body>
  <h2>íŒŒì¼ ì—…ë¡œë“œ</h2>
  <form action="" id="upload-form"><input type="file">
    <button onclick="uploadFile()">upload</button>
  </form>
  <div id="fileList"></div>

  <script>
    const $fileList = document.getElementById('fileList')
    // const $button = document.querySelector('form#upload-form > button')

    fetch('http://localhost:3000/file_list', {
      headers: { Accept: 'application/json' }, // ì‘ë‹µì„ json í˜•íƒœë¡œ ìš”ì²­
      method: 'GET',
    }).then(res => {
      if (res.status >= 400) { // 400 ì´ìƒì€ ë¹„ì •ìƒ ì½”ë“œ, catchë¬¸ì—ì„œ ì—ëŸ¬ ì²˜ë¦¬
        return Promise.reject(new Error(`status: ${res.status}`))
      }
      return res.json()
    }).then(data => {
      let table = '<table><tr><td>íŒŒì¼ ë¦¬ìŠ¤íŠ¸</td><td>ì—…ë¡œë“œ ì‹œê°„</td></tr>'

      data.forEach(file => {
        const timestamp = file.match(/\d\w+/g)
        const time = timestamp[0]
        const date = new Date(Number(time))

        table += `<tr><td>${file}</td><td>${date}</td></tr>`
      })

      table += '</table>'
      $fileList.innerHTML = table
    }).catch(err => alert(err))

    const uploadFile = () => {
      const $input = document.querySelector('input[type="file"]');
      const formData = new FormData()

      formData.append('file', input.files[0])

      fetch('http://localhost:3000/upload', {
        headers: { Accept: 'application/json' },
        method: 'POST',
        body: formData
      }).then(res => {
        if (res.status >= 400) {
          return Promise.reject(new Error(`status: ${res.status}`))
        }
        return res.text() // utf-8ë¡œ ë””ì½”ë”©ëœ í…ìŠ¤íŠ¸ ì‘ë‹µ ê²°ê³¼ë¥¼ ë°˜í™˜ğŸ‘¼ 
      }).then(res => alert(res))
        .catch(err => alert(err))
    }
  </script>
</body>
</html>